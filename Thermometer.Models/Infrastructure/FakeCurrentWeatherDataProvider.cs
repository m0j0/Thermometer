using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using MugenMvvmToolkit;
using Newtonsoft.Json;
using Thermometer.Extensions;
using Thermometer.Interfaces;
using Thermometer.JsonModels;
using Thermometer.Projections;

namespace Thermometer.Infrastructure
{
    internal class FakeCurrentWeatherDataProvider : ICurrentWeatherDataProvider
    {
        #region Constants

        private const string GetDevicesResponse =
            @"{""devices"":[{""id"":1602,""owner"":""maxamp"",""my"":0,""name"":""24temp.ru (1)"",""location"":""\u0443\u043b.\u0411\u0435\u0440\u0435\u0437\u0438\u043d\u0430, 154\u0410, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":1.27,""time"":1455772545,""lat"":56.029692,""lng"":92.860091,""liked"":12,""uptime"":99,""sensors"":[{""id"":4639,""pub"":1,""type"":2,""name"":""\u0412\u043b\u0430\u0436\u043d\u043e\u0441\u0442\u044c"",""value"":68,""unit"":""%"",""time"":1455772545},{""id"":4641,""pub"":1,""type"":3,""name"":""\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435"",""value"":755,""unit"":""mmHg"",""time"":1455772545},{""id"":4638,""pub"":1,""type"":1,""name"":""\u0422\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430"",""value"":-8.3,""unit"":""\u00b0"",""time"":1455772545}]},{""id"":6927,""owner"":""aleks74"",""my"":0,""name"":""Ethernet"",""location"":""\u0412\u0437\u043b\u0435\u0442\u043d\u0430\u044f \u0443\u043b., 24, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":1.64,""time"":1455773902,""lat"":56.033762,""lng"":92.905395,""liked"":3,""uptime"":99,""sensors"":[{""id"":19308,""pub"":1,""type"":3,""name"":""\u0443\u043b.\u0412\u0437\u043b\u0435\u0442\u043d\u0430\u044f"",""value"":757.14,""unit"":""mmHg"",""time"":1455773601}]},{""id"":7732,""owner"":""ADimDroid"",""my"":0,""name"":""1010.ESP"",""location"":""\u0443\u043b.\u041b\u0435\u043d\u0438\u043d\u0430, 133, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":2.78,""time"":1455773948,""lat"":56.012048,""lng"":92.847541,""liked"":7,""uptime"":98,""sensors"":[{""id"":21969,""pub"":1,""type"":3,""name"":""\u0410\u0442\u043c\u043e\u0441\u0444\u0435\u0440\u043d\u043e\u0435 \u0434\u0430\u0432\u043b\u0435\u043d\u0438\u0435"",""value"":762.98,""unit"":""mmHg"",""time"":1455773648},{""id"":21933,""pub"":1,""type"":2,""name"":""\u0412\u043b\u0430\u0436\u043d\u043e\u0441\u0442\u044c \u0432\u043e\u0437\u0434\u0443\u0445\u0430"",""value"":58.1,""unit"":""%"",""time"":1455773648},{""id"":21970,""pub"":1,""type"":11,""name"":""\u041e\u0441\u0432\u0435\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u043d\u0430 \u0443\u043b\u0438\u0446\u0435"",""value"":4993,""unit"":""Lx"",""time"":1455773648},{""id"":21939,""pub"":1,""type"":1,""name"":""\u0422\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430 \u0432\u043e\u0437\u0434\u0443\u0445\u0430"",""value"":-7,""unit"":""\u00b0"",""time"":1455773648}]},{""id"":8456,""owner"":""boss22"",""my"":0,""name"":""ID_8456"",""location"":""\u0443\u043b.9 \u041c\u0430\u044f, 56\u0410, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":3.6,""time"":1455774002,""lat"":56.057783,""lng"":92.906959,""liked"":7,""uptime"":98,""sensors"":[{""id"":24897,""pub"":1,""type"":2,""name"":""\u0443\u043b.9 \u041c\u0430\u044f, 56\u0410, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""value"":65.6,""unit"":""%"",""time"":1455773701},{""id"":24898,""pub"":1,""type"":3,""name"":""\u0443\u043b.9 \u041c\u0430\u044f, 56\u0410, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""value"":754.8,""unit"":""mmHg"",""time"":1455773701},{""id"":24896,""pub"":1,""type"":1,""name"":""\u0443\u043b.9 \u041c\u0430\u044f, 56\u0410, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""value"":-9,""unit"":""\u00b0"",""time"":1455773701}]},{""id"":10743,""owner"":""pawel"",""my"":0,""name"":""\u0412\u043e\u0434\u043e\u043f\u044c\u044f\u043d\u043e\u0432\u0430 11"",""location"":""\u0443\u043b.\u0412\u043e\u0434\u043e\u043f\u044c\u044f\u043d\u043e\u0432\u0430, 11, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":3.92,""time"":1455773112,""lat"":56.059971,""lng"":92.91072,""liked"":2,""uptime"":98,""sensors"":[{""id"":31450,""pub"":1,""type"":1,""name"":""\u0423\u043b\u0438\u0447\u043d\u0430\u044f \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430"",""value"":-7.56,""unit"":""\u00b0"",""time"":1455773112}]},{""id"":382,""owner"":""krasland.ru"",""my"":0,""name"":""krasland.ru"",""location"":""\u0443\u043b.60 \u043b\u0435\u0442 \u041e\u043a\u0442\u044f\u0431\u0440\u044f, 59\u0410, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":5.53,""time"":1455773877,""lat"":55.979964,""lng"":92.866117,""liked"":1,""uptime"":96,""sensors"":[{""id"":2584,""pub"":1,""type"":1,""name"":""\u0422\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430"",""value"":-6,""unit"":""\u00b0"",""time"":1455773264}]},{""id"":66460,""owner"":""radioman-krsk"",""my"":0,""name"":""esp8266"",""location"":""\u0443\u043b.\u0427\u0430\u0439\u043a\u043e\u0432\u0441\u043a\u043e\u0433\u043e, 14, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":5.72,""time"":1455773971,""lat"":56.016982,""lng"":92.969964,""liked"":1,""uptime"":93,""sensors"":[{""id"":242,""pub"":1,""type"":1,""name"":""DS18B20 Out"",""value"":-4.9,""unit"":""\u00b0"",""time"":1455773671}]},{""id"":6717,""owner"":""algissw"",""my"":0,""name"":""algisswwork"",""location"":""\u0443\u043b.\u041a\u0430\u043b\u0438\u043d\u0438\u043d\u0430, 82, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":6.04,""time"":1455773929,""lat"":56.040906,""lng"":92.785635,""liked"":3,""uptime"":75,""sensors"":[{""id"":18690,""pub"":1,""type"":1,""name"":""\u0422\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430"",""value"":-7.5,""unit"":""\u00b0"",""time"":1455773629}]},{""id"":10536,""owner"":""blackmore2000"",""my"":0,""name"":""ESP8266 METEO"",""location"":""\u0443\u043b.\u041a\u0443\u0442\u0443\u0437\u043e\u0432\u0430, 77\u0410, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":6.4,""time"":1455773862,""lat"":55.986717,""lng"":92.950254,""liked"":4,""uptime"":99,""sensors"":[{""id"":30544,""pub"":1,""type"":1,""name"":""\u0423\u043b\u0438\u0447\u043d\u0430\u044f \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430"",""value"":-7.7,""unit"":""\u00b0"",""time"":1455773862}]},{""id"":1475,""owner"":""tmp24.ru"",""my"":0,""name"":""ID_1475"",""location"":""\u041f\u043e\u043b\u0438\u0433\u043e\u043d\u043d\u0430\u044f \u0443\u043b., 8, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":6.51,""time"":1455773951,""lat"":56.073881,""lng"":92.947757,""liked"":6,""uptime"":99,""sensors"":[{""id"":3910,""pub"":1,""type"":1,""name"":""Poligonnaya st."",""value"":-6.25,""unit"":""\u00b0"",""time"":1455773394}]},{""id"":4242,""owner"":""algissw"",""my"":0,""name"":""MyHome"",""location"":""\u0411\u043e\u0445\u0442\u0438\u043d\u0441\u043a\u0438\u0439 \u043f\u0435\u0440\u0435\u0443\u043b\u043e\u043a, 5, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":6.35,""time"":1455773925,""lat"":56.045641,""lng"":92.782829,""liked"":4,""uptime"":99,""sensors"":[{""id"":12175,""pub"":1,""type"":1,""name"":""\u0423\u043b\u0438\u0446\u0430"",""value"":-6.6,""unit"":""\u00b0"",""time"":1455773563}]},{""id"":10709,""owner"":""Alexei"",""my"":0,""name"":""\u0418\u0418\u0424\u0438\u0420\u042d"",""location"":""\u0443\u043b.\u0410\u043a\u0430\u0434\u0435\u043c\u0438\u043a\u0430 \u041a\u0438\u0440\u0435\u043d\u0441\u043a\u043e\u0433\u043e, 28, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":6.46,""time"":1455773918,""lat"":55.996213,""lng"":92.79478,""liked"":11,""uptime"":98,""sensors"":[{""id"":31310,""pub"":1,""type"":2,""name"":""\u0412\u043b\u0430\u0436\u043d\u043e\u0441\u0442\u044c"",""value"":63.2,""unit"":""%"",""time"":1455773558},{""id"":31309,""pub"":1,""type"":3,""name"":""\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435"",""value"":750.81,""unit"":""mmHg"",""time"":1455773558},{""id"":31375,""pub"":1,""type"":5,""name"":""\u041d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0432\u0435\u0442\u0440\u0430"",""value"":289,""unit"":""\u00b0"",""time"":1455773558},{""id"":31374,""pub"":1,""type"":4,""name"":""\u0421\u043a\u043e\u0440\u043e\u0441\u0442\u044c \u0432\u0435\u0440\u0442\u0430"",""value"":2,""unit"":""m\/s"",""time"":1455773558},{""id"":31308,""pub"":1,""type"":1,""name"":""\u0422\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430"",""value"":-8.6,""unit"":""\u00b0"",""time"":1455773558}]},{""id"":3582,""owner"":""ayava"",""my"":0,""name"":""GALAXY NEXUS I9250"",""location"":""\u0443\u043b.\u0429\u043e\u0440\u0441\u0430, 19, \u041a\u0440\u0430\u0441\u043d\u043e\u044f\u0440\u0441\u043a"",""distance"":6.55,""time"":1455773932,""lat"":55.993261,""lng"":92.964241,""liked"":8,""uptime"":96,""sensors"":[{""id"":18087,""pub"":1,""type"":3,""name"":""Galaxy Nexus"",""value"":758.46,""unit"":""mmHg"",""time"":1455772171}]}]}";

        private const string SensorHistoryResonse =
            "{\"data\":[{\"time\":1456205701,\"value\":-9.8},{\"time\":1456209008,\"value\":-9.6},{\"time\":1456212314,\"value\":-9.1},{\"time\":1456215621,\"value\":-9.3},{\"time\":1456218927,\"value\":-9.5},{\"time\":1456222234,\"value\":-9.3},{\"time\":1456225541,\"value\":-9.3},{\"time\":1456228847,\"value\":-9.3},{\"time\":1456232154,\"value\":-9.3},{\"time\":1456235460,\"value\":-9.3},{\"time\":1456238767,\"value\":-9.3},{\"time\":1456242074,\"value\":-9.1},{\"time\":1456245380,\"value\":-9.3},{\"time\":1456248687,\"value\":-9.1},{\"time\":1456251993,\"value\":-9.6},{\"time\":1456255300,\"value\":-9.6},{\"time\":1456258606,\"value\":-10.1},{\"time\":1456261913,\"value\":-10.3},{\"time\":1456265220,\"value\":-10.6},{\"time\":1456268526,\"value\":-11.1},{\"time\":1456271832,\"value\":-11.5},{\"time\":1456275139,\"value\":-11.8},{\"time\":1456278445,\"value\":-11.8},{\"time\":1456281751,\"value\":-11.1},{\"time\":1456285058,\"value\":-9.3},{\"time\":1456288365,\"value\":-8.1}]}";

        #endregion

        #region Methods

        public Task<IList<DeviceProjection>> GetDevicesAsync()
        {
            var response = JsonConvert.DeserializeObject<SensorsNearbyResponse>(GetDevicesResponse);
            return Task.FromResult<IList<DeviceProjection>>(NarodMonExtensions.ConvertSensorsNearbyResponseToDeviceProjections(response));
        }

        public Task UpdateSensorHistoryAsync(SensorProjection sensor, SensorHistoryPeriod period, DateTime offset)
        {
            //var response = JsonConvert.DeserializeObject<SensorLogResponse>(SensorHistoryResonse);
            //foreach (var responseData in response.Data)
            //{
            //    sensor.Data.Add(new SensorHistoryData(ModelExtensions.UnixTimeStampToDateTime(responseData.Time, true), responseData.Value));
            //}

            var random = new Random();
            for (var i = 0; i < 100; i++)
            {
                sensor.Data.Add(new SensorHistoryData(DateTime.Now - TimeSpan.FromHours(i), (random.NextDouble() - 0.5) * 50));
            }
            return Empty.Task;
        }

        #endregion
    }
}